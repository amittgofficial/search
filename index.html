<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AmitXBhai Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .box {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      margin: auto;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: none;
      font-family: monospace;
      background: #333;
      color: #fff;
    }
    button {
      padding: 10px 20px;
      border-radius: 8px;
      background: #00c853;
      color: #fff;
      border: none;
      margin: 6px 4px;
      cursor: pointer;
    }
    .output {
      white-space: pre-wrap;
      background: #000;
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
    }
    .copy-btn {
      margin-top: 10px;
      background: #1565c0;
    }

    /* ‚úÖ Centered code section */
    .code-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 30px auto 10px;
      max-width: 400px;
    }
    .code-center input,
    .code-center button {
      width: 100%;
      margin: 6px 0;
    }

    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(30, 30, 30, 0.9);
      color: #fff;
      padding: 20px 25px;
      border-radius: 12px;
      display: none;
      z-index: 999;
      font-weight: bold;
      text-align: center;
      min-width: 200px;
      box-shadow: 0 0 10px #00c853;
    }
    .toast .loader {
      border: 4px solid #333;
      border-top: 4px solid #00e676;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      margin: 10px auto 0;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #dateInput, #listInput, #confirmBtn {
      display: none;
    }

    #loginSection {
      max-width: 400px;
      margin: auto;
      margin-top: 100px;
      display: none;
    }
  </style>
</head>
<body>

  <!-- üîê Login Section -->
  <div class="box" id="loginSection">
    <h2>üîê Login</h2>
    <input type="text" id="usernameInput" placeholder="Enter your name..." />
    <button onclick="saveLogin()">üö™ Login</button>
  </div>

  <!-- üõ† Tool Section -->
  <div class="box" id="toolSection" style="display:none;">
    <h2>AmitXBhai Code Tool</h2>
    <div><b>üë§ User:</b> <span id="usernameShow"></span></div>

    <!-- ‚úÖ Centered Save Code & Show -->
    <div class="code-center">
      <input type="text" id="codeInput" placeholder="Enter your code">
      <button onclick="insertCode()">üíæ Save Code</button>
      <button onclick="showList()">üëÄ Show</button>
    </div>

    <!-- ‚úÖ Separated List Save Button -->
    <button onclick="startSaveList()">üìã List Save</button>

    <!-- Hidden until List Save tapped -->
    <input type="text" id="dateInput" placeholder="üóì Enter Date (e.g., 15 June)">
    <textarea id="listInput" rows="6" placeholder="üìÑ Paste your list..."></textarea>
    <button id="confirmBtn" onclick="saveList()">üíæ Confirm Save</button>

    <!-- Output and Copy -->
    <div id="result" class="output"></div>
    <button id="copyBtn" class="copy-btn" style="display:none;" onclick="copyResult()">üìã Copy</button>
  </div>

  <!-- ‚úÖ Toast Message -->
  <div class="toast" id="toast"></div>

  <script>
    let userData = {
      date: '',
      list: [],
      nextIndex: 0
    };

    function showToast(msg, color = "#00c853", reload = false, withLoader = false) {
      const toast = document.getElementById("toast");
      toast.innerHTML = withLoader
        ? `<div>${msg}</div><div class="loader"></div>`
        : msg;
      toast.style.background = color;
      toast.style.display = "block";

      setTimeout(() => {
        toast.style.display = "none";
        if (reload) location.reload();
      }, withLoader ? 2000 : 1500);
    }

    function saveLogin() {
      const username = document.getElementById("usernameInput").value.trim();
      if (!username) return showToast("‚ùå Username required!", "#ff1744");
      localStorage.setItem("amit_user_name", username);
      showToast("‚úÖ Login Saved!", "#00c853", true);
    }

    function startSaveList() {
      document.getElementById("dateInput").style.display = "block";
      document.getElementById("listInput").style.display = "block";
      document.getElementById("confirmBtn").style.display = "inline-block";
      showToast("üìã Now enter date and list...");
    }

    function saveList() {
      const date = document.getElementById("dateInput").value.trim();
      const lines = document.getElementById("listInput").value.trim().split("\n");

      if (!date || lines.length === 0) {
        showToast("‚ùå Date ya List missing!", "#ff1744");
        return;
      }

      let cleaned = [];
      for (let line of lines) {
        line = line.trim();
        if (!line) continue;
        let parts = line.split(/\s+/);
        let serial = parseInt(parts[0]);
        if (!isNaN(serial)) {
          if (line.toLowerCase().includes("del")) {
            cleaned.push({ serial, value: "deleted" });
          } else {
            cleaned.push({ serial, value: parts[parts.length - 1] });
          }
        }
      }

      userData = {
        date,
        list: cleaned,
        nextIndex: 0
      };

      localStorage.setItem("amit_user_data", JSON.stringify(userData));
      showToast("‚úÖ List saved!", "#00c853", true, true);
    }

    function insertCode() {
      const val = document.getElementById("codeInput").value.trim();
      const [code, number] = val.split(/\s+/);
      if (!code || !number || (code.length !== 8 && code.length !== 9) || isNaN(number)) {
        showToast("‚ùå Format: ABC123456 2300", "#ff1744");
        return;
      }

      for (let i = userData.nextIndex; i < userData.list.length; i++) {
        let item = userData.list[i];
        if (item.value !== "deleted" && !item.value.includes(" ")) {
          item.value = `${code}   ${number}   ${item.value}`;
          userData.nextIndex = i + 1;
          localStorage.setItem("amit_user_data", JSON.stringify(userData));
          showToast(`‚úÖ Code saved!`, "#00c853", true, true);
          return;
        }
      }
      showToast("‚ö†Ô∏è No space left to insert.", "#ff9100");
    }

    function showList() {
      const saved = localStorage.getItem("amit_user_data");
      const resultEl = document.getElementById("result");
      const copyBtn = document.getElementById("copyBtn");

      if (!saved) {
        resultEl.innerText = "No data.";
        copyBtn.style.display = "none";
        return;
      }
      const data = JSON.parse(saved);
      let output = `**${data.date}**\n\n****\n\n`;
      for (let item of data.list) {
        let val = item.value.replace(/\b([A-Za-z0-9]{8,9})\b/g, "`$1`");
        output += `${item.serial}.   ${val}\n\n`;
      }
      resultEl.innerText = output;
      copyBtn.style.display = "inline-block";
    }

    function copyResult() {
      const text = document.getElementById("result").innerText;
      navigator.clipboard.writeText(text).then(() => {
        showToast("üìã Copied!");
      });
    }

    window.onload = () => {
      const savedName = localStorage.getItem("amit_user_name");
      if (!savedName) {
        document.getElementById("loginSection").style.display = "block";
        return;
      }

      document.getElementById("toolSection").style.display = "block";
      document.getElementById("usernameShow").innerText = savedName;

      const saved = localStorage.getItem("amit_user_data");
      if (saved) userData = JSON.parse(saved);
    };
  </script>
</body>
</html>
