<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AmitXBhai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 20px;
    }
    .box {
      background: #222;
      padding: 20px;
      border-radius: 12px;
      max-width: 600px;
      margin: auto;
    }
    textarea, input {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
      border: none;
      font-family: monospace;
      background: #333;
      color: #fff;
    }
    button {
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
    }
    .output {
      white-space: pre-wrap;
      background: #000;
      padding: 15px;
      margin-top: 10px;
      border-radius: 8px;
    }
    .btn-list { background: #8e24aa; color: #fff; }
    .btn-save { background: #2e7d32; color: #fff; }
    .btn-show { background: #1565c0; color: #fff; }
    .btn-copy { background: #f57c00; color: #fff; }
    .btn-confirm { background: #00897b; color: #fff; }
    .btn-mono { background: #00acc1; color: #fff; }
    button:hover {
      opacity: 0.9;
      transform: scale(1.03);
      transition: 0.2s ease-in-out;
    }
    .code-center {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 30px auto 10px;
      max-width: 400px;
    }
    .code-center input,
    .code-center button {
      width: 100%;
      margin: 6px 0;
    }
    .toast {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(30, 30, 30, 0.9);
      color: #fff;
      padding: 20px 25px;
      border-radius: 12px;
      display: none;
      z-index: 999;
      font-weight: bold;
      text-align: center;
      min-width: 200px;
      box-shadow: 0 0 10px #00c853;
    }
    .toast .loader {
      border: 4px solid #333;
      border-top: 4px solid #00e676;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      margin: 10px auto 0;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #dateInput, #listInput, #confirmBtn,
    #monoInput, #monoRunBtn, #monoResult, #copyMono, #historyOutput {
      display: none;
    }
    #loginSection {
      max-width: 400px;
      margin: auto;
      margin-top: 100px;
      display: none;
    }
  </style>
</head>
<body>

<div class="box" id="loginSection">
  <h2>ğŸ” Login</h2>
  <input type="text" id="usernameInput" placeholder="Enter your name..." />
  <button onclick="saveLogin()">ğŸšª Login</button>
</div>

<div class="box" id="toolSection" style="display:none;">
  <div style="display: flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px;">
    <div><b>ğŸ‘¤ User:</b> <span id="usernameShow"></span></div>
    <div>
      <button onclick="toggleSection('home')" class="btn-confirm">ğŸ  Home</button>
      <button onclick="toggleSection('list')" class="btn-list">ğŸ“‹ List</button>
      <button onclick="toggleSection('mono')" class="btn-mono">ğŸ’  Mono</button>
      <button onclick="toggleSection('history')" class="btn-show">ğŸ“œ History</button>
    </div>
  </div>

  <div class="code-center" id="codeSection">
    <input type="text" id="codeInput" placeholder="Enter your code" oninput="autoFocusNumber()" />
    <input type="number" id="numberInput" placeholder="Enter number" />
    <button onclick="insertCode()" class="btn-save">ğŸ’¾ Save Code</button>
  </div>

  <input type="text" id="dateInput" placeholder="ğŸ—“ Enter Date (e.g., 15 June)">
  <textarea id="listInput" rows="6" placeholder="ğŸ“„ Paste your list..."></textarea>
  <button id="confirmBtn" onclick="saveList()" class="btn-confirm">ğŸ’¾ Confirm Save</button>

  <textarea id="monoInput" rows="6" placeholder="ğŸ”¤ Paste mono list (codes)..."></textarea>
  <button id="monoRunBtn" onclick="runMono()" class="btn-mono">âš™ï¸ Convert Mono</button>
  <div id="monoResult" class="output"></div>
  <button id="copyMono" class="btn-copy" onclick="copyMonoResult()">ğŸ“‹ Copy Mono</button>

  <div id="result" class="output"></div>
  <button id="copyBtn" class="btn-copy" onclick="copyResult()">ğŸ“‹ Copy</button>
  <button id="saveHistoryBtn" class="btn-save" onclick="saveUpdatedListToHistory()">ğŸ’¾ Save List</button>

  <div id="historyOutput" class="output"></div>
</div>

<div class="toast" id="toast"></div>

<script>
  let userData = { date: '', list: [], nextIndex: 0 };

  function showToast(msg, color = "#00c853", reload = false, withLoader = false) {
    const toast = document.getElementById("toast");
    toast.innerHTML = withLoader ? `<div>${msg}</div><div class="loader"></div>` : msg;
    toast.style.background = color;
    toast.style.display = "block";
    setTimeout(() => {
      toast.style.display = "none";
      if (reload) location.reload();
    }, withLoader ? 2000 : 1500);
  }

  function saveLogin() {
    const username = document.getElementById("usernameInput").value.trim();
    if (!username) return showToast("âŒ Username required!", "#ff1744");
    localStorage.setItem("amit_user_name", username);
    showToast("âœ… Login Saved!", "#00c853", true);
  }

  function toggleSection(mode) {
    const ids = ["dateInput", "listInput", "confirmBtn", "monoInput", "monoRunBtn", "monoResult", "copyMono", "historyOutput"];
    ids.forEach(id => document.getElementById(id).style.display = "none");
    document.getElementById("codeSection").style.display = mode === "home" ? "flex" : "none";

    if (mode === "list") {
      document.getElementById("dateInput").style.display = "block";
      document.getElementById("listInput").style.display = "block";
      document.getElementById("confirmBtn").style.display = "inline-block";
    } else if (mode === "mono") {
      document.getElementById("monoInput").style.display = "block";
      document.getElementById("monoRunBtn").style.display = "inline-block";
    } else if (mode === "history") {
      showHistory();
    }
  }

  function saveList() {
    const date = document.getElementById("dateInput").value.trim();
    const lines = document.getElementById("listInput").value.trim().split("\n");
    if (!date || lines.length === 0) return showToast("âŒ Date ya List missing!", "#ff1744");

    let cleaned = [];
    for (let line of lines) {
      line = line.trim();
      if (!line) continue;
      let parts = line.split(/\s+/);
      let serial = parseInt(parts[0]);
      if (!isNaN(serial)) {
        if (line.toLowerCase().includes("del")) {
          cleaned.push({ serial, value: "deleted" });
        } else {
          cleaned.push({ serial, value: parts[parts.length - 1] });
        }
      }
    }

    userData = { date, list: cleaned, nextIndex: 0 };
    localStorage.setItem("amit_user_data", JSON.stringify(userData));
    showToast("âœ… List saved!", "#00c853", true, true);
  }

  function insertCode() {
    const code = document.getElementById("codeInput").value.trim();
    const number = document.getElementById("numberInput").value.trim();
    if (!code || !number || (code.length !== 8 && code.length !== 9) || isNaN(number)) {
      showToast("âŒ Format: ABC123456 + 2300", "#ff1744");
      return;
    }

    for (let i = userData.nextIndex; i < userData.list.length; i++) {
      let item = userData.list[i];
      if (item.value !== "deleted" && !item.value.includes(" ")) {
        item.value = `${code}   ${number}   ${item.value}`;
        userData.nextIndex = i + 1;
        localStorage.setItem("amit_user_data", JSON.stringify(userData));
        showToast(`âœ… Code saved!`, "#00c853", true, true);
        showList();
        return;
      }
    }

    showToast("âš ï¸ No space left to insert.", "#ff9100");
  }

  function showList() {
    const saved = localStorage.getItem("amit_user_data");
    const resultEl = document.getElementById("result");
    const copyBtn = document.getElementById("copyBtn");
    if (!saved) {
      resultEl.innerText = "No data.";
      copyBtn.style.display = "none";
      return;
    }

    const data = JSON.parse(saved);
    let output = `**${data.date}**\n\n****\n\n`;
    for (let item of data.list) {
      let val = item.value.replace(/\b([A-Za-z0-9]{8,9})\b/g, "`$1`");
      output += `${item.serial}.   ${val}\n\n`;
    }
    resultEl.innerText = output;
    copyBtn.style.display = "inline-block";
  }

  function copyResult() {
    const text = document.getElementById("result").innerText;
    navigator.clipboard.writeText(text).then(() => showToast("ğŸ“‹ Copied!"));
  }

  function runMono() {
    const lines = document.getElementById("monoInput").value.trim().split("\n");
    let output = lines.map(line => line.trim()).filter(line => line).map(line => line.replace(/\b([A-Za-z0-9]{8,9})\b/, "`$1`")).join("\n\n");

    document.getElementById("monoResult").innerText = output;
    document.getElementById("monoResult").style.display = "block";
    document.getElementById("copyMono").style.display = "inline-block";
    showToast("âœ… Converted to mono");
  }

  function copyMonoResult() {
    const text = document.getElementById("monoResult").innerText;
    navigator.clipboard.writeText(text).then(() => showToast("ğŸ“‹ Mono Copied!"));
  }

  function autoFocusNumber() {
    const codeField = document.getElementById("codeInput");
    const numberField = document.getElementById("numberInput");
    if (codeField.value.trim().length >= 8) numberField.focus();
  }

  function saveUpdatedListToHistory() {
    const saved = localStorage.getItem("amit_user_data");
    if (!saved) return showToast("âŒ No list to save!");
    const data = JSON.parse(saved);
    const output = document.getElementById("result").innerText.trim();
    if (!output) return showToast("âš ï¸ Nothing to save.");

    let history = JSON.parse(localStorage.getItem("amit_final_history") || "[]");
    history.unshift({ date: data.date, output });
    localStorage.setItem("amit_final_history", JSON.stringify(history));
    showToast("âœ… Saved to history!");
  }

  function showHistory() {
    const container = document.getElementById("historyOutput");
    let history = JSON.parse(localStorage.getItem("amit_final_history") || "[]");
    if (!history.length) {
      container.innerHTML = "ğŸ“­ No saved history.";
    } else {
      container.innerHTML = `<h3>ğŸ“œ Saved Lists:</h3>` + history.map((h, i) =>
        `<div style="margin-bottom: 10px;"><b>ğŸ“… ${h.date}</b> 
          <button onclick="copyHistory(${i})" class="btn-copy">ğŸ“‹ Copy</button> 
          <button onclick="deleteHistory(${i})" class="btn-confirm">ğŸ—‘ Delete</button>
        </div>`).join("");
    }
    container.style.display = "block";
  }

  function copyHistory(i) {
    const history = JSON.parse(localStorage.getItem("amit_final_history") || "[]");
    if (history[i]) {
      navigator.clipboard.writeText(history[i].output).then(() => showToast("ğŸ“‹ History Copied!"));
    }
  }

  function deleteHistory(i) {
    let history = JSON.parse(localStorage.getItem("amit_final_history") || "[]");
    history.splice(i, 1);
    localStorage.setItem("amit_final_history", JSON.stringify(history));
    showToast("ğŸ—‘ Deleted!");
    showHistory();
  }

  window.onload = () => {
    const savedName = localStorage.getItem("amit_user_name");
    if (!savedName) {
      document.getElementById("loginSection").style.display = "block";
      return;
    }
    document.getElementById("toolSection").style.display = "block";
    document.getElementById("usernameShow").innerText = savedName;
    document.getElementById("codeSection").style.display = "flex";
    const saved = localStorage.getItem("amit_user_data");
    if (saved) {
      userData = JSON.parse(saved);
      showList();
    }
  };
</script>

</body>
</html>
